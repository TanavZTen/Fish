<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Literature (Authors) – No Communication</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at center, #1f7a4a, #0b3b22);
  font-family: Arial, Helvetica, sans-serif;
}
.felt {
  background: radial-gradient(circle, #2e8b57, #14532d);
}
.seat {
  position: absolute;
  width: 120px;
  text-align: center;
  color: white;
}
.card {
  width: 42px;
  height: 60px;
  background: white;
  border-radius: 6px;
  border: 2px solid black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}
.card-back {
  width: 32px;
  height: 44px;
  background: linear-gradient(#2563eb, #1e3a8a);
  border-radius: 4px;
  border: 2px solid white;
}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* ===================== CONSTANTS ===================== */

const SETS = [
  ["2♠","3♠","4♠","5♠","6♠","7♠"],
  ["9♠","10♠","J♠","Q♠","K♠","A♠"],
  ["2♥","3♥","4♥","5♥","6♥","7♥"],
  ["9♥","10♥","J♥","Q♥","K♥","A♥"],
  ["2♣","3♣","4♣","5♣","6♣","7♣"],
  ["9♣","10♣","J♣","Q♣","K♣","A♣"],
  ["2♦","3♦","4♦","5♦","6♦","7♦"],
  ["9♦","10♦","J♦","Q♦","K♦","A♦"],
  ["8♠","8♥","8♣","8♦","RJ","BJ"]
];

const ALL_CARDS = SETS.flat();

/* ===================== HELPERS ===================== */

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

/* ===================== APP ===================== */

function App(){
  const [players,setPlayers]=useState([]);
  const [hands,setHands]=useState({});
  const [currentAsker,setCurrentAsker]=useState(null);
  const [currentTeam,setCurrentTeam]=useState(null);
  const [recentAsks,setRecentAsks]=useState([]);
  const [options,setOptions]=useState({
    showCounts:true,
    recentAskCount:2,
    timeLimit:0
  });
  const [timer,setTimer]=useState(null);

  /* ===================== SETUP ===================== */

  function startGame(){
    const deck=[...ALL_CARDS];
    shuffle(deck);

    const h={};
    players.forEach(p=>h[p.id]=[]);

    deck.forEach((c,i)=>{
      h[players[i%players.length].id].push(c);
    });

    setHands(h);
    setCurrentAsker(players[0].id);
    setCurrentTeam(players[0].team);
  }

  /* ===================== TIMER ===================== */

  useEffect(()=>{
    if(!options.timeLimit || !currentAsker) return;
    setTimer(options.timeLimit);
    const i=setInterval(()=>{
      setTimer(t=>{
        if(t===1){
          forceTurnLoss();
          return null;
        }
        return t-1;
      });
    },1000);
    return()=>clearInterval(i);
  },[currentAsker]);

  function forceTurnLoss(){
    const opponents=players.filter(p=>p.team!==currentTeam);
    if(opponents.length){
      setCurrentAsker(opponents[0].id);
      setCurrentTeam(opponents[0].team);
    }
  }

  /* ===================== ASK LOGIC ===================== */

  function askCard(fromId,card){
    const asker=currentAsker;
    const has=hands[fromId].includes(card);

    setRecentAsks(a=>[
      {from:asker,to:fromId,card,success:has},
      ...a
    ].slice(0,options.recentAskCount));

    if(has){
      setHands(h=>{
        const nh={...h};
        nh[fromId]=nh[fromId].filter(c=>c!==card);
        nh[asker]=[...nh[asker],card];
        return nh;
      });
    }else{
      setCurrentAsker(fromId);
      setCurrentTeam(players.find(p=>p.id===fromId).team);
    }
  }

  /* ===================== UI ===================== */

  return (
    <div className="felt min-h-screen relative">
      <div className="absolute top-4 left-4 text-white">
        Current Team: {currentTeam}
        {timer && <div>Time: {timer}</div>}
      </div>

      {/* RECENT ASKS */}
      <div className="absolute top-4 right-4 bg-black bg-opacity-50 p-2 text-white rounded">
        {recentAsks.map((a,i)=>(
          <div key={i}>
            {a.from} → {a.to} : {a.card} {a.success?"✓":"✗"}
          </div>
        ))}
      </div>

      {/* TABLE */}
      <div className="w-[600px] h-[600px] mx-auto relative mt-20">
        {players.map((p,i)=>{
          const ang=i/players.length*2*Math.PI;
          return (
            <div key={p.id}
              className="seat"
              style={{
                left:300+Math.cos(ang)*230,
                top:300+Math.sin(ang)*230
              }}>
              <div className="bg-red-700 rounded px-2">
                {p.name}
              </div>
              <div className="flex justify-center mt-1">
                {options.showCounts
                  ? <div>{hands[p.id]?.length||0} cards</div>
                  : <div className="card-back"></div>}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

/* ===================== RENDER ===================== */
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
